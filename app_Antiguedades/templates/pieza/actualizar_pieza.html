{# app_Antiguedades/templates/pieza/actualizar_pieza.html #}
{% extends "base.html" %}
{% block title %}Actualizar Pieza de Antigüedad{% endblock %}
{% block content %}
<h2 class="mb-4">Actualizar Pieza: **{{ pieza.nombre }}**</h2>
<div class="card shadow-lg p-3 mb-5 bg-body rounded">
    <div class="card-body">
        <form method="post" action="{% url 'realizar_actualizacion_pieza' pieza.id %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="id_nombre" class="form-label">Nombre de la pieza:</label>
                    <input type="text" class="form-control" id="id_nombre" name="nombre" value="{{ pieza.nombre }}" required>
                </div>
                <div class="col-md-6">
                    <label for="id_proveedor" class="form-label">Proveedor:</label>
                    <select class="form-select" id="id_proveedor" name="proveedor" required>
                        {% for proveedor in proveedores %}
                            <option value="{{ proveedor.id }}" {% if pieza.proveedor.id == proveedor.id %}selected{% endif %}>
                                {{ proveedor.nombre_empresa }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-12">
                    <label for="id_descripcion" class="form-label">Descripción detallada:</label>
                    <textarea class="form-control" id="id_descripcion" name="descripcion" rows="3" required>{{ pieza.descripcion }}</textarea>
                </div>
                <div class="col-md-4">
                    <label for="id_precio" class="form-label">Precio de venta ($):</label>
                    <input type="number" step="0.01" class="form-control" id="id_precio" name="precio" value="{{ pieza.precio }}" required>
                </div>
                <div class="col-md-4">
                    <label for="id_año_fabricacion" class="form-label">Año de fabricación:</label>
                    <input type="number" class="form-control" id="id_año_fabricacion" name="año_fabricacion" min="1000" max="1950" value="{{ pieza.año_fabricacion }}" required>
                </div>
                <div class="col-md-4">
                    <label for="id_estado_conservacion" class="form-label">Estado de conservación:</label>
                    <select class="form-select" id="id_estado_conservacion" name="estado_conservacion" required>
                        {% for choice_value, choice_name in pieza.ESTADOS_CONSERVACION %}
                            <option value="{{ choice_value }}" {% if pieza.estado_conservacion == choice_value %}selected{% endif %}>
                                {{ choice_name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-12">
                    <label class="form-label">Imagen Actual:</label>
                    {% if pieza.imagen %}
                        <p><img src="{{ pieza.imagen.url }}" alt="{{ pieza.nombre }}" style="max-width: 200px; height: auto; border-radius: 5px;"></p>
                        <p class="text-muted small">Suba un archivo nuevo para reemplazar la imagen actual.</p>
                    {% else %}
                        <p class="text-muted">No hay imagen cargada.</p>
                    {% endif %}
                    
                    <label for="id_imagen" class="form-label">Subir Nueva Imagen (Opcional):</label>
                    <input type="file" class="form-control" id="id_imagen" name="imagen" accept="image/*">
                </div>
            </div>

            <div class="d-flex justify-content-end mt-4">
                <a href="{% url 'ver_piezas' %}" class="btn btn-secondary me-2">Cancelar</a>
                <button type="submit" class="btn btn-primary">Actualizar Pieza</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}